<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nds.library.mypage.IMypageDAO">

	<select id="BorrowingList" resultType="com.nds.library.mypage.Borrowing">
		SELECT * FROM borrowings
	</select>


	<select id="requireBookList" parameterType="java.util.Map"
		resultType="com.nds.library.mypage.ReqAndDon">
		select image, title, author, publisher, TO_CHAR(registered_date,
		'yyyy-mm-dd') AS registered_date,
		current_state, TO_CHAR(finished_date,
		'yyyy-mm-dd') AS finished_date, manager_comment
		from reqanddon

		<if test="filter == 0">  <!-- 전체 -->
			where (current_state='신청대기'
			or current_state='신청완료' or
			current_state='구매완료' or current_state='신청반려')
		</if>
		<if test="filter == 1">  <!-- 구매완료 -->
			where current_state='구매완료'
		</if>
		<if test="filter == 2">  <!-- 신청완료 -->
			where current_state='신청완료'
		</if>
		<if test="filter == 3"> <!-- 신청대기 -->
			where current_state='신청대기'
		</if>
		<if test="filter == 4">  <!-- 신청반려 -->
			where current_state='신청반려'
		</if>
		and user_id=4 order by registered_date desc
	</select>

	<insert id="requireBookAdd">

		INSERT INTO ReqAndDon(req_don_id,
		manager_id,
		user_id, current_state, registered_date, user_comment,
		manager_comment, finished_date
		, isbn, title, author, publisher, image,
		pubdate, explanation)
		VALUES((SELECT NVL(MAX(req_don_id)+1, 1) FROM
		ReqAndDon), 1, 4,
		'신청대기', sysdate, #{user_comment}, null, null,
		#{isbn},
		#{title}, #{author},
		#{publisher},#{image},
		#{pubdate},
		#{explanation})
	</insert>
</mapper>   